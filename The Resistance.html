<html lang="en">
  <head>
	<link rel="stylesheet" media="screen" type="text/css" title="Exemple" href="main.css"/>
  </head>
  <body>
  <script
  src="https://code.jquery.com/jquery-3.2.1.js"
  integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
  crossorigin="anonymous"></script>
   <nav id="nav">
	<ul>
		<li><a data-target="register" href="">Register</a></li>
		<li><a data-target="connection" href="">Connect</a></li>
	</ul>
  </nav>
  <div class="page" id="register">
            <fieldset>
                <legend>Register</legend>
                <p>Please register to play</p>
				<label for="login">Login<span class="requis">*</span></label>
                <input type="login" id="login" name="login" value="" size="20" maxlength="60" />
                <br />
                <label for="password">Password<span class="requis">*</span></label>
                <input type="password" id="password" name="password" value="" size="20" maxlength="20" />
                <br />
                <input type="submit" id="submitRegister" value="Register"/>
                <br />
            </fieldset>
  </div>
  <div class="page" id="ongoinggame">
	<p>You want to : </p>
	<input type="submit" id="submitJoin" value="Join the next game"/>
	<input type="submit" id="submitWatch" value="Watch the current game"/>
  </div>
  <div class="page" id="game">
	<table id="rounds">
		<tr>
		<td>1st round</td>
		<td>2nd round</td>
		<td>3rd round</td>
		<td>4th round</td>
		<td>5th round</td>
		</tr>
	</table>
	<table id="players">
		<tr>
		<td></td><
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		</tr>
	</table>
	
	<!-- <fieldset>
     <legend>Un chat en jQuery</legend>
      <div id="conversation"></div><br />
      <form action="#" method="post">
        <input type="text" id="nom" value="pseudo" size="6">
        <input type="text" id="message" size="27">
        <button type="button" id="envoyer" title="Envoyer"><img src="envoyer.gif"></button>
      </form>
    </fieldset> -->
	
  </div>
  <div class="page" id="connection">
            <fieldset>
                <legend>Connection</legend>
                <p>Please log in to play</p>
                <label for="login">Login<span class="requis">*</span></label>
                <input type="login" id="login" name="login" value="" size="20" maxlength="60" />
                <br />
                <label for="password">Password<span class="requis">*</span></label>
                <input type="password" id="password" name="password" value="" size="20" maxlength="20" />
                <br />
                <input type="submit" id="submitConnection" value="Login" class="sansLabel" />
                <br />
            </fieldset>

  </div>
  	<div id="results"></div>
  <script>
    /*$(function() {
    afficheConversation();    
    $('#envoyer').click(function() {
        var nom = $('#nom').val();
        var message = $('#message').val();
        $.post('chat.php', {
            'nom': nom,
            'message': message
        }, afficheConversation);
    });

    function afficheConversation() {
      $('#conversation').load('ac.htm');
      $('#message').val('');
      $('#message').focus();
    }
    setInterval(afficheConversation, 4000);
  });*/
  </script>
   <script>
		
		
		$(document).ready(function(){
			var cfg = {
				domain: 'http://ogg.elwinar.com:56789',
			};
			var state = {
			};
			
			$("#nav > ul > li > a").on("click", function(event){
				var target = $(event.target).attr('data-target');
				$(".page").hide();
				$("#"+target).show();
				return false;
			});
			$(".page:not(:first-of-type)").hide();
			
			function authenticate(){
				console.log(state.token);
				$.ajax({
					type: "POST",
					headers: {"token": state.token},
					url: cfg.domain + "/authenticate",
					success: function(data){
						if(data.authenticated === true){
							return;
						}
						login();
					},
					dataType:"json",
				})
			};
			
			function login(){
				$.ajax({
					type: "POST",
					contentType:"application/json",
					data: JSON.stringify({
						'login': state.login,
						'password': state.password,
					}),
					url: cfg.domain + "/login",
					success: function(data) {
						state.token = data.token;
						if(typeof state.authenticateInterval == "undefined") {
							state.authenticateInterval = setInterval(authenticate, 5000);
						}
					},
					error: function(data){
						$("#results").html("<p style='background-color:red'>Sorry something went wrong, please try again !</p>");
					},
					dataType: "json",
				});
			};
			$("#submitConnection").on("click", function connect(){
				$("#connection").hide();
				state.login = $("#login").val();
				state.password = $("#password").val();
				login();
			});
			$("#submitRegister").on("click", function register(){
				$("#register").hide();
				state.login = $("#login").val();
				state.password = $("#password").val();
				login();
			});
		});
  </script>
  </body>
</html>
